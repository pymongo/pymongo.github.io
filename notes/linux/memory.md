# Linux内存管理笔记

操作系统以页为单位管理内存，linux的PageSize=4Kb

## 虚拟内存

虚拟内存在操作系统中的作用: 进程和物理内存之间的中间层

现代的操作系统都引入了虚拟内存，进程持有的`Virtual Address`会经过`Memory Management Unit`的转换变成物理地址

### 虚拟内存的作用

1. 作为硬盘的缓存，提高进程访问硬盘的速度
2. 为进程提供独立的内存空间，可采用虚存共享的方式实现进程间通信
3. 控制进程对物理内存的访问，隔离不同进程的访问权限，提高系统安全性
4. 在分配程序所需的内存空间时，包括malloc分配的也是虚拟内存空间，不需要连续的物理内存，可以碎片化利用内存资源
5. 当不同进程使用同样的数据时，可以只在物理内存中存一份，不同进程只需要将虚拟内存映射过去就可以了，提高内存利用率，节约内存

## 虚拟页

虚拟内存中的虚拟页的三种状态: Unallocated、Uncached、Cached

未分配的内存也是没有被经常进程申请使用的

缓存和未缓存的区别是：缓存过的数据是存在物理内存上，而未缓存的数据还在硬盘上

## 缺页中断(Page Fault)

当进程访问未虚拟内存中未缓存的虚拟页时，硬件就会触发「缺页中断」

如果虚拟页没被加载到内存中，操作系统需要将未缓存的相应虚拟页加载到内存中

如果虚拟页其实在内存中了，但是进程的Page Table不存在虚拟页到物理内存地址的映射关系，此时只需要建立这种映射关系就行了

## 操作系统调页算法

由于内存是有限的，操作系统需要选择不用的数据驱逐回硬盘，选择待驱逐页的过程称为「页面替换」

缺页中断和页面替换属于操作系统调页算法的一部分

## 从内存中的数据到硬盘中数据的切换算法

