# [Goè¯­è¨€å­¦ä¹ ](/2020/04/golang.md)

æœ€è¿‘æˆ‘åœ¨è¯»ä¸€äº›goé¡¹ç›®çš„æºç ï¼Œå‘ç°Rustå…¶å®å€Ÿé‰´äº†å¾ˆå¤šgoä¸€äº›å…³é”®è¯å’Œæœºåˆ¶ä¾‹å¦‚`panic`

goå’ŒRustä¸€æ ·è‡ªå¸¦äº†benchmark,test,fmtç­‰åŠŸèƒ½ï¼Œåªä¸è¿‡goçš„å·¥å…·ä¸°å¯Œç¨‹åº¦è¿˜ä¸å¦‚Rust

æˆ‘èŠ±äº†åŠå°æ—¶çœ‹å®ŒGoè¯­è¨€çš„èœé¸Ÿæ•™ç¨‹ï¼Œåˆæ­¥ç»“è®ºæ˜¯Goçš„channelç¡®å®è®©æˆ‘çœ¼å‰ä¸€äº®å€¼å¾—ä¸€å­¦ï¼Œè¯­è¨€è¯­æ³•ç³–çº§åˆ«çš„åç¨‹

~~æˆ‘æ‰“ç®—ä»¥å“²å­¦å®¶è¿›é¤é—®é¢˜ä¸ºä¾‹å•ç‹¬å†™ç¯‡æ–‡ç« ç ”ç©¶ä¸‹Goçš„goroutine+channel~~

ä½†æ˜¯Goè¯­è¨€ä½œä¸ºå”¯ä¸€ä¸€ä¸ªæš‚ä¸æ”¯æŒæ³›å‹ç­‰é«˜çº§æŠ½è±¡çš„ä¸»æµé™æ€ç¼–è¯‘è¯­è¨€(è¯´å®è¯Goçš„ä¸€äº›åŒ…è¢±å’Œå…¼å®¹æ€§å†³å®šGo2çš„æ³›å‹æˆ‘ä¹Ÿä¸æ˜¯å¾ˆçœ‹å¥½)ï¼Œ

åè€Œè¦ä¾èµ–åå°„ã€interfaceç­‰é¢å¤–çš„è¿è¡Œæ—¶overheadå»å®ç°"æ³›å‹"

Goä¹Ÿä¸æ”¯æŒå®/å…ƒç¼–ç¨‹(codegençš„åŠŸèƒ½å¯èƒ½ä¸èƒ½åƒRustå®é‚£æ ·ä»ç¼–è¯‘åŸç†ASTçš„æ›´ç»†è…»çš„ç²’åº¦å»å±•å¼€ä»£ç )

ä½œä¸ºç°ä»£åŒ–ç¼–ç¨‹è¯­è¨€ï¼ŒGoæœªå…ä¹Ÿå¤ªå¤§é“è‡³ç®€å§ï¼Œè¿iterator,for_each,map,reduce,generatorç­‰APIéƒ½æ²¡æœ‰ï¼Œ

ä¸ªäººæ„Ÿè§‰å¯èƒ½è¿‡äºå—åˆ°Cè¯­è¨€ä¹‹çˆ¶ç­‰è€çš„Unixå¤§ç‰›å½±å“ï¼Œå¾ˆå¤šCè¯­è¨€æ²¡æœ‰ä½†æ˜¯å¾ˆé‡è¦çš„è¿­ä»£å™¨Goä¹Ÿå­¦Cè¯­è¨€é‚£æ ·ä¸é›†æˆ

å¦‚æœç”¨Goæˆ–Cåšinfraå€’æ— æ‰€è°“ï¼Œä½†æ˜¯åšä¸šåŠ¡CRUDæ²¡æœ‰mapæˆ–for_eachçœŸçš„å¥½å—ï¼Ÿ

## Goè¯­è¨€åæ§½

- å·¥ç¨‹ä¸Š: æ²¡æœ‰åŒºåˆ†æ„å»ºå·¥å…·å’Œç¼–è¯‘å·¥å…·ï¼Œæ²¡æœ‰cargo initæˆ–cargo newç­‰ç­‰åˆå§‹åŒ–é¡¹ç›®çš„è§„èŒƒï¼Œæ„å»ºéš¾
- å·¥ç¨‹ä¸Š: åŒ…ç®¡ç†å¾ˆçƒ‚
- æ¨¡å—ç®¡ç†ä¸å¤Ÿå¥½ç”¨
- æ²¡æœ‰è¿­ä»£å™¨ã€ç”Ÿæˆå™¨ã€mapã€for_eachã€reduceç­‰ç­‰å‡½æ•°å¼API(è¿‡åº¦å‚è€ƒCè¯­è¨€)
- æ²¡æœ‰æ¨¡å¼åŒ¹é…
- å­—ç¬¦å¤„ç†ä¸ç»Ÿä¸€ï¼Œæ²¡æœ‰ç»Ÿä¸€æˆUnicode(è¿‡åº¦å‚è€ƒCè¯­è¨€)
- é”™è¯¯å¤„ç†å¾ˆå‚»å¾ˆç®€å•ç²—æš´
- é¦–å­—æ¯å¤§å°å†™è¡¨ç¤ºå…¬æœ‰ç§æœ‰(å¸¦æ¥æ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿç ´åäº†é©¼å³°å‘½åå¸¸é‡å‘½åçš„ä¸€äº›ä¸šç•Œçº¦å®š)

---

## æ–¹æ³•è®º:å¦‚ä½•å­¦ä¹ æ–°è¯­è¨€

å¯¹äºæŒæ¡å¤šé—¨ç¼–ç¨‹è¯­è¨€æœ‰ç»éªŒçš„å¼€å‘è€…è€Œè¨€ï¼Œä»¥ä¸‹æ˜¯æˆ‘è®¤ä¸ºæœ€ä½³çš„å­¦ä¹ è·¯çº¿

1. å­¦ä¹ åŒ…ç®¡ç†/é¡¹ç›®æ„å»ºå·¥å…·ï¼Œä¾‹å¦‚maven/npmï¼Œç†è§£é¡¹ç›®æ–‡ä»¶ç»“æ„
2. åˆ©ç”¨ç¬¬ä¸‰æ–¹ä¾èµ–å¼€å‘ä¸€ä¸ªhttp client/serverï¼Œèƒ½è¯»å†™ç®€å•çš„jsonæ•°æ®
3. ç®€å•äº†è§£ä¸‹æ–°è¯­è¨€çš„å•å…ƒæµ‹è¯•å’Œbenchmarkçš„ä½¿ç”¨
4. å»leetcodeä¸Šæ‰¾Easyçš„é¢˜åšä¸€é“
5. è§£å†³å“²å­¦å®¶è¿›é¤é—®é¢˜ï¼Œç†è§£æ–°è¯­è¨€åœ¨å¤šçº¿ç¨‹ä¸Šçš„åº”ç”¨

> actix-webå’Œginæ€§èƒ½æ¯”è¾ƒ

åè®°: actix-webå¹¶ä¸æ˜¯Rustæœ€å¿«æœ€è½»é‡çš„Webæ¡†æ¶ï¼Œæ€§èƒ½ä¸å¦‚tideæˆ–warpç­‰ï¼Œæ‰€ä»¥ä¸åº”è¯¥æ‹¿actix-webå»æ¯”go

æˆ‘æµ‹è¯•äº†rustå’Œgo staræ•°æœ€å¤šä»¥åŠæœ€å¿«çš„æ¡†æ¶ï¼Œç”¨ab -n 1000 -c 200åœ¨æˆ‘æœ¬åœ°çš„mbp2019(i5 8Gå†…å­˜)ä¸Šçš„æµ‹è¯•ç»“æœæ˜¯

actix(17000)ï¼Œgin(16500)ï¼Œiris(21000)

~~æ²¡æƒ³åˆ°Rust staræœ€å¤šçš„rocketæ¡†æ¶æ€§èƒ½å¦‚æ­¤ç³Ÿç³•ğŸ˜°(ç°åœ¨rocketè¾¹å¼‚æ­¥äº†ï¼Œæ€§èƒ½é£å‡)~~

ç”±äºginæ‰“äº†logä¼šå½±å“æ€§èƒ½ï¼Œactixå’Œiriséƒ½æ²¡æ‰“ï¼Œæ‰€ä»¥ginå’Œactixçš„æ€§èƒ½å®é™…ä¸Šå·®è·ä¸å¤§

è€Œirisèƒ½é¢†å…ˆgin/actix 15%~25%çš„æ€§èƒ½ï¼Œæ¯ç§’ç”šè‡³èƒ½å¤„ç†23000ä¸ªè¯·æ±‚(10å€äºrails)ï¼Œå®åœ¨å¼ºæ‚

æˆ‘ç”¨ab -n 5000 -c 5000é€šè¿‡è¿”å›"pong"å­—ç¬¦ä¸²çš„æ¥å£æµ‹è¯•äº†Rustå’ŒGoå¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–åçš„æ€§èƒ½ã€‚actix-webæ¯ç§’èƒ½å¤„ç†25368ä¸ªè¯·æ±‚ï¼ŒGo-irisèƒ½å¤„ç†25787ä¸ªè¯·æ±‚ã€‚

Rustä»Debugç‰ˆç¼–è¯‘æ¢æˆreleaseç‰ˆç¼–è¯‘åŠ ä¸Šä¸€äº›ç¼–è¯‘ä¼˜åŒ–åï¼Œæ€§èƒ½ä»1.7ä¸‡æå‡åˆ°2.5ä¸‡ï¼Œè€ŒGoåªæ˜¯ä»2.2ä¸‡æå‡åˆ°2.5ä¸‡

> Goè¯­è¨€æœ€å¿«çš„irisæ¡†æ¶å¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–åçš„é€Ÿåº¦

![](go_iris_benchmark.png)

> Rustè¯­è¨€å¼€å¯releaseç‰ˆæœ¬ç¼–è¯‘åçš„é€Ÿåº¦

![](rust_actix_benchmark.png)

Rustç¼–è¯‘å™¨é€‰é¡¹é‡Œå¯ä»¥æŠŠé»˜è®¤çš„å†…å­˜ç®¡ç†å™¨æ¢æˆFreeBSDçš„jemallocæˆ–è€…å¾®è½¯çš„mimallocï¼Œå…·ä½“æ•ˆæœå¦‚ä½•æˆ‘æ²¡å°è¯•äº†ã€‚

æˆ‘macç”µè„‘abå‘½ä»¤æœ€å¤šå¼€åˆ°5000å¹¶å‘ï¼Œå¼€1ä¸‡æˆ–2ä¸‡å¹¶å‘ä¼šæç¤ºsocketåœ°å€ä¸å¤Ÿç”¨äº†ï¼Œå¯èƒ½æˆ‘ä¹‹å‰ä¸å°å¿ƒç”¨chownæ”¹äº†æ–‡ä»¶æƒé™ï¼Œä¹Ÿå¯èƒ½æ˜¯ç«¯å£æœ¬æ¥å°±ä¸å¤Ÿç”¨ï¼Œæ‰€ä»¥æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒ

## GoåŒ…ç®¡ç†å·¥å…·(go mod)

åœ¨å®˜æ–¹æ²¡æœ‰æ¨å‡ºgo-modulesåŒ…ç®¡ç†å·¥å…·æ—¶ï¼Œæœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„åŒ…ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå¦‚go-vendor

ä¸è¿‡go-modulesæ„Ÿè§‰ä¸å¦‚gem/maven/npmç­‰å…¶å®ƒè¯­è¨€çš„åŒ…ç®¡ç†å¥½ç”¨ï¼Œæ›´æ¯”ä¸ä¸Šcargo

> go mod init go_http_client

ä¼šç”Ÿæˆä¸€ä¸ªgo.modçš„æ–‡ä»¶

åœ¨main.goä¸­æ·»åŠ `import "github.com/gin-gonic/gin"`(GoçŸ¥åWebæœåŠ¡å™¨)å

æ‰§è¡Œ`go mod tidy`ä¼šè‡ªåŠ¨å°†ä¾èµ–ä¸‹è½½åˆ°`GOPATH/pkg/mod`ä¸­

æ­¤æ—¶go.modæ–‡ä»¶å¤šäº†ä¸€è¡Œ`require github.com/gin-gonic/gin v1.6.2`

è¿˜å¤šäº†ä¸€ä¸ªgo.sumæ–‡ä»¶(ç±»ä¼¼package.json-lock)

å¦‚æœå¸Œæœ›å°†é¡¹ç›®ä¾èµ–çš„åŒ…ç§»åˆ°é¡¹ç›®æ–‡ä»¶å¤¹å†…ï¼Œå¯ä»¥ä½¿ç”¨`go mod vendor`ã€‚

## Goé¡¹ç›®æ„å»º

[golang-standards/project-layout](https://github.com/golang-standards/project-layout)

æˆ‘éå¸¸å–œæ¬¢Rustè¯­è¨€åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œèƒ½ç¼–è¯‘å¤šä¸ªbin(å¯æ‰§è¡Œæ–‡ä»¶)ï¼Œä»¥åŠå¤šä¸ªexamplesçš„ç‰¹æ€§ï¼Œå†™å®Œä¸€ä¸ªå‡½æ•°å°±èƒ½ç›´æ¥è¿è¡Œçš„çˆ½å¿«ä½“éªŒ

[How to structure Go application to produce multiple binaries?](https://stackoverflow.com/questions/50904560/how-to-structure-go-application-to-produce-multiple-binaries/50904959)

[golang çš„ç¼–è¯‘æ²¡æœ‰ debug release ä¹‹åˆ†å—ï¼Ÿ](https://www.v2ex.com/t/561636)

> go build -o ${output} {source.go}

---

æˆ‘è¿˜æ˜¯æ¯”è¾ƒæ¬£èµGoä¼šå¯¹unsed variables/importç»™å‡ºç¼–è¯‘é”™è¯¯ï¼Œä½†æ˜¯Rusté‚£æ ·å¯ä»¥é€šè¿‡é…ç½®unusedè­¦å‘Šæ˜¯å¦å‡çº§ä¸ºErroræ›´çµæ´»
