# [NFT价格预言机](/2024/06/nft_price_oracle.md)

NFT借贷或者合约需要预言机价格从off-chain多个市场获取地板价(floor price就是网游拍卖行同一装备的最低价)，但NFT同一装备有属性词条区分，拿地板价估值肯定不准确且流动性差用地板价未必能在爆仓的时候强平卖掉

想起defi一般的借贷协议都没有对钱包信用做评估，都是抵押物模式，能否出一个芝麻信用的预言机关联公民社会信用可以零抵押借钱？通过zk的方式传递数据，这样虽然链上所有数据透明用zk方式传递信用就不会泄露隐私

> A decentralized oracle network that securely and reliably enables smart contracts to access off-chain identity or credential-related data feeds and web APIs

## 闪电网络和layer2

btc闪电网络通过创建支付通道来实现快速、低成本的交易。通道的两端是用户，他们可以在通道内进行多次交易，而不需要每次都记录在主链上

以太坊的Layer 2解决方案包括多种技术，如状态通道、Rollups（包括Optimistic Rollups和ZK Rollups）和Plasma(通过创建子链来处理大量交易，子链的状态定期提交到以太坊主链上)等

## btc mempool待交易队列

> btc的多个validator之间，都想抢一笔gas费用高的交易，不会数据竞争吗

在比特币网络中，矿工（也可以理解为验证者）之间确实会竞争打包交易以获得交易费用的奖励。然而，比特币的设计和共识机制有效地解决了数据竞争问题，确保了整个网络的一致性。以下是详细解释：

### 比特币网络的交易确认流程

1. **交易广播**：当用户发起一笔比特币交易时，这笔交易会被广播到比特币网络中的所有节点。
   
2. **交易进入 Mempool**：各个节点在验证交易的有效性后，会将这笔交易存储在自己的 Mempool 中。所有有效的交易都在等待被矿工打包进区块。

3. **矿工选择交易**：矿工从 Mempool 中选择交易进行打包，通常优先选择交易费较高的交易，以获得更高的奖励。

4. **区块打包和挖矿**：矿工将选中的交易打包成一个新的区块，并通过工作量证明（PoW）机制进行挖矿，尝试找到一个满足难度要求的哈希值。

5. **区块广播和验证**：一旦某个矿工成功挖出一个新的区块，该区块会被广播到整个网络，其他节点会验证区块的有效性并将其添加到区块链中。

### 数据竞争的解决机制

虽然多个矿工可能同时竞争打包同一笔高交易费的交易，但比特币网络通过以下机制解决了数据竞争问题：

1. **工作量证明（PoW）**：PoW 机制要求矿工进行大量计算工作来找到一个满足难度要求的哈希值。这个过程是随机的，矿工无法预测谁会首先找到有效的哈希值。

2. **最长链原则**：比特币网络遵循最长链（或最重链）原则。当节点在同一高度上接收到多个有效区块时，它们会选择包含最多累积工作量的链。这确保了网络最终会收敛到一个统一的链。

3. **区块传播延迟**：由于网络传播延迟，不同矿工可能在不同时间接收到新挖出的区块。这会导致短暂的链分叉，但最终会通过最长链原则解决。

4. **交易重复处理**：如果一笔交易已经被某个区块打包并确认，其他矿工在打包交易时会检测到这笔交易已经被确认，从而避免重复打包。

### 实际情况中的竞争

在实际操作中，矿工确实会优先选择高交易费的交易进行打包，但由于 PoW 机制的随机性，无法保证某个特定矿工一定能够成功打包某笔交易。这种竞争机制反而提高了网络的安全性和去中心化程度。

---

## 交易所钱包归集

中心化交易所在比特币链上的归集测试通常是指交易所将分散在多个钱包中的比特币（BTC）资金集中到一个或少数几个钱包地址中的过程。这一过程通常是为了更方便地管理资金、支付大额费用或罚款、提高资金的安全性和流动性等

ok归集btc钱包的时候出了一个bug 在btc主网mempool队列上，每个交易的gas费都给了几个btc... 一下损失几百个btc(几千万上亿)

> https://x.com/1999_eth/status/1799090788753965159
